@{
    ViewData["Title"] = "Course Details";
    string currentUser = User.Identity.IsAuthenticated ? User.Identity.Name : "";

    bool isEnrolled = Model.EnrolledStudents.Any(s => s.Username == currentUser) || Model.ActiveTeachers.Any(t => t.Username == currentUser);
    bool isActiveTeacherOrAdmin = User.Identity.IsAuthenticated && (Model.ActiveTeachers.Any(t => t.Username == User.Identity.Name) || User.IsInRole("Admin"));

    string teacherButtonsVisibility = "hidden";
    if (isActiveTeacherOrAdmin)
    {
        teacherButtonsVisibility = "visible";
    }

    string enrollVisbility = "hidden";
    if (!isEnrolled)
    {
        enrollVisbility = "visible";
    }

    DateTime? startingDate = Model.StartingDate;

}

@model Course

@*COURSE HEADER*@
<div class="d-flex course-header justify-content-between">

    <div class="d-flex flex-column" style="width: 75%">
        <div>
            <h4>
                <img class="language-flag" src="~/images/flags/@(Model.CourseTopic).jpg" alt="" />
                @Model.Title
            </h4>
        </div>

        <div style="margin-bottom: 1px;">
            <i class="fa-regular fa-calendar" style="margin-left:4px; margin-right:1px;"></i> @Model.StartingDate.ToString()
            <i class="fa-regular fa-user" style="margin-left:4px; margin-right: 1px;"></i> @Model.EnrolledStudents.Count()
            <i class="fa-regular fa-file" style="margin-left:4px; margin-right: 1px;"></i> @Model.Lectures.Count()
        </div>

    </div>

    <div class="d-flex align-items-center">

        <form asp-controller="Course" asp-action="Enroll" asp-route-id="@Model.Id" method="post">
            <button type="submit" class="btn btn-success" style="visibility: @enrollVisbility; margin-right: 20px">Enroll</button>
        </form>

    </div>

</div>
<br/>


<div class="d-flex justify-content-between">
    <div class="d-flex flex-column" style="width: 75%">
        @*VIDEO*@
        <div>
            <iframe style="width: 100%; aspect-ratio: 16/9" src="https://www.youtube.com/embed/4t7BgyA7IOI" title="dance" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div>

        @*INFO BLOCK*@
        <div>
            <div class="d-flex flex-column" style="width: 100%">
                <div>
                    @Model.Description
                </div>
                <hr />
                <div class="d-flex justify-content-between">
                    <div>
                        Teachers:
                        @{
                            foreach (var teacher in Model.ActiveTeachers)
                            {
                                <a href="#" class="btn btn-secondary btn-sm"> @teacher.FirstName @teacher.LastName</a>
                            }
                        }
                    </div>
                    
                    <div>
                        @{
                            <a class="btn btn-success btn-sm" style="visibility: @teacherButtonsVisibility;" asp-controller="Course" asp-action="Update" asp-route-id="@Model.Id">Update course</a>
                        }
                    </div>

                </div>

            </div>
        </div>
    </div>

    @*LECTURE MENU*@
    <div class="d-flex" style="width: 24%; height: 520px;">
        <div class="card" style="width: 100%">

            <div class="card-header">
                <div class="d-flex justify-content-between">
                    <strong>Lectures</strong>
                    <a class="btn btn-success btn-sm" style="visibility: @teacherButtonsVisibility" asp-controller="Lecture" asp-action="Create" asp-route-courseId="@Model.Id">New</a>
                </div>

                
            </div>

            <ul class="list-group list-group-flush" style="max-height: 500px; overflow-y: auto;">
                @{
                    int counter = 1;

                    foreach (var lecture in Model.Lectures)
                    {
                        <li class="list-group-item">
                            <a asp-controller="Lecture" asp-action="Details" asp-route-courseId="@Model.Id" asp-route-id="@lecture.Id" style="text-decoration:none;">@counter. @lecture.Title</a>
                        </li>

                        counter++;
                    }
                }
            </ul>

            
        </div>
    </div>
</div>

Students:
@{
    foreach (var student in Model.EnrolledStudents)
    {
        <span>@student.FirstName @student.LastName, </span>
    }
}

    